(function(t){function e(e){for(var n,i,s=e[0],c=e[1],u=e[2],f=0,p=[];f<s.length;f++)i=s[f],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&p.push(o[i][0]),o[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);l&&l(e);while(p.length)p.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var t,e=0;e<a.length;e++){for(var r=a[e],n=!0,s=1;s<r.length;s++){var c=r[s];0!==o[c]&&(n=!1)}n&&(a.splice(e--,1),t=i(i.s=r[0]))}return t}var n={},o={app:0},a=[];function i(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=n,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var l=c;a.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("cd49")},"1af3":function(t,e,r){"use strict";r("2d70")},"21bb":function(t,e,r){"use strict";r("2dad")},"2d70":function(t,e,r){},"2dad":function(t,e,r){},3056:function(t,e,r){"use strict";r("5d23")},"5c0b":function(t,e,r){"use strict";r("9c0c")},"5d23":function(t,e,r){},"9c0c":function(t,e,r){},cd49:function(t,e,r){"use strict";r.r(e);var n=r("2b0e"),o=r("e508"),a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[t.isAppReady()?r("router-view",{attrs:{id:"app-view"}}):t._e()],1)},i=[],s=r("9ab4"),c=r("60a3"),u="https://puss.vap.cx/scrobbles",l="https://api.spotify.com/v1",f=r("a34a"),p=r.n(f),y=r("ba10"),b=r.n(y),d=r("db82"),h=r.n(d);function v(t){return v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,o)}function g(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){m(a,n,o,i,s,"next",t)}function s(t){m(a,n,o,i,s,"throw",t)}i(void 0)}))}}function k(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function w(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function O(t,e,r){return e&&w(t.prototype,e),r&&w(t,r),t}function _(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}function j(t,e){return j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},j(t,e)}function S(t){var e=D();return function(){var r,n=x(t);if(e){var o=x(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return P(this,r)}}function P(t,e){return!e||"object"!==v(e)&&"function"!==typeof e?T(t):e}function T(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function D(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function x(t){return x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},x(t)}var R=function(t){_(r,t);var e=S(r);function r(t,n,o){var a;return k(this,r),a=e.call(this),n&&a.setToken(n,o),a.apiBase=t,a}return O(r,[{key:"setToken",value:function(t,e){this.token=e?"".concat(e," ").concat(t):t,this.emit("tokenUpdate")}},{key:"apiRequestRaw",value:function(t,e,r){var n=h.a[t](this.apiBase+e);return this.token&&(n=n.set("Authorization",this.token)),r&&(n=n.send(r)),new Promise((function(t,e){n.end((function(r,n){r&&e(r),n&&t(n)}))}))}},{key:"apiRequestBody",value:function(){var t=g(p.a.mark((function t(e,r,n){var o;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.apiRequestRaw(e,r,n);case 2:return o=t.sent,t.abrupt("return",o.body);case 4:case"end":return t.stop()}}),t,this)})));function e(e,r,n){return t.apply(this,arguments)}return e}()},{key:"isAuthenticated",get:function(){return Boolean(this.token)}}]),r}(b.a);function C(t){return C="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},C(t)}function I(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function U(t,e,r){return e&&E(t.prototype,e),r&&E(t,r),t}function A(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&H(t,e)}function H(t,e){return H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},H(t,e)}function M(t){var e=$();return function(){var r,n=N(t);if(e){var o=N(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return L(this,r)}}function L(t,e){return!e||"object"!==C(e)&&"function"!==typeof e?B(t):e}function B(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function N(t){return N=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},N(t)}var q=function(t){A(r,t);var e=M(r);function r(t){var n;return I(this,r),n=e.call(this,l),t.getSpotifyToken().then((function(t){t.token?n.setToken(t.token,t.tokenType):console.error("Could not get spotify token: token is null")})).catch((function(t){console.error("Could not get spotify token:",t)})),n}return U(r,[{key:"getTrack",value:function(t){return this.apiRequestBody("get","/tracks/".concat(t))}},{key:"getTracks",value:function(t){return this.apiRequestBody("get","/tracks?ids=".concat(t.join(",")))}},{key:"getAlbum",value:function(t){return this.apiRequestBody("get","/albums/".concat(t))}},{key:"getPlaylist",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.apiRequestBody("get","/playlists/".concat(t,"?").concat(e))}}]),r}(R);function V(t){return V="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function J(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,o)}function z(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){J(a,n,o,i,s,"next",t)}function s(t){J(a,n,o,i,s,"throw",t)}i(void 0)}))}}function Q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function W(t,e,r){return e&&G(t.prototype,e),r&&G(t,r),t}function F(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&K(t,e)}function K(t,e){return K=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},K(t,e)}function X(t){var e=tt();return function(){var r,n=et(t);if(e){var o=et(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Y(this,r)}}function Y(t,e){return!e||"object"!==V(e)&&"function"!==typeof e?Z(t):e}function Z(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function tt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function et(t){return et=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},et(t)}var rt=function(t){F(r,t);var e=X(r);function r(){return Q(this,r),e.call(this,u)}return W(r,[{key:"getSpotifyToken",value:function(){var t=z(p.a.mark((function t(){var e;return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.apiRequestBody("get","/spotify-token");case 2:return e=t.sent,t.abrupt("return",{token:e.token,tokenType:e.type});case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getUsers",value:function(t){return this.apiRequestBody("get","?q=".concat(t.join(",")))}}]),r}(R),nt=new rt,ot=new q(nt);function at(t){return at="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},at(t)}function it(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ct(t,e,r){return e&&st(t.prototype,e),r&&st(t,r),t}function ut(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lt(t,e)}function lt(t,e){return lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},lt(t,e)}function ft(t){var e=bt();return function(){var r,n=dt(t);if(e){var o=dt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return pt(this,r)}}function pt(t,e){return!e||"object"!==at(e)&&"function"!==typeof e?yt(t):e}function yt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function bt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function dt(t){return dt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},dt(t)}var ht=function(t){ut(r,t);var e=ft(r);function r(){var t;return it(this,r),t=e.apply(this,arguments),t.spotifyApiReady=!1,t}return ct(r,[{key:"isAppReady",value:function(){return this.spotifyApiReady}},{key:"created",value:function(){var t=this;ot.isAuthenticated?this.spotifyApiReady=!0:ot.on("tokenUpdate",(function(){ot.isAuthenticated?t.spotifyApiReady=!0:t.spotifyApiReady=!1})),setInterval((function(){t.$store.dispatch("updateNow")}),1e3)}}]),r}(c["c"]);ht=Object(s["a"])([Object(c["a"])({name:"App"})],ht);var vt=ht,mt=vt,gt=(r("5c0b"),r("2877")),kt=Object(gt["a"])(mt,a,i,!1,null,null,null),wt=kt.exports,Ot=r("8c4f"),_t=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"home"},[t.ready?r("div",{staticClass:"feed"},[r("DynamicScroller",{staticClass:"scroller",attrs:{items:t.userIds,"min-item-size":36},scopedSlots:t._u([{key:"default",fn:function(t){var e=t.item,n=t.index,o=t.active;return[r("DynamicScrollerItem",{attrs:{item:e,active:o,"data-index":n}},[r("User",{attrs:{userId:e}})],1)]}}],null,!1,2148141531)})],1):r("div",{staticClass:"splash"},[r("div",{staticClass:"progress-desc"},[t._v(t._s(t.loadingData.desc))]),r("div",{staticClass:"progress-bar"},[r("div",{staticClass:"progress",style:{width:Math.max(Math.round(t.loadingData.complete/t.loadingData.total*100),2)+"%"}})])])])},jt=[],St=r("2f24"),Pt=r("2f62"),Tt=r("4328"),Dt=r.n(Tt),xt=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"user"},[t.user?r("div",{staticClass:"header"},[r("img",{staticClass:"avatar",attrs:{src:t.avatarUrl},on:{error:t.onAvatarError}}),r("div",{staticClass:"tag"},[r("div",{staticClass:"username"},[t._v(t._s(t.user.username))]),r("div",{staticClass:"discrim"},[t._v("#"+t._s(t.user.discriminator))])]),r("div",{staticClass:"spacer"},["Not Listening"===t.status&&t.lastScrobbleTime?r("div",[t._v("("+t._s(t.formatTimeDiff(t.nowDate-t.lastScrobbleTime))+")")]):t._e()]),"Listening"===t.status?r("div",{staticClass:"status"},[t._v(t._s(t.status))]):t._e(),r("div",{staticClass:"status-circle",style:{background:t.statusColor}})]):t._e(),t.isUser&&t.now?r("Track",{attrs:{trackId:t.now,autoPalette:!0,showPalette:t.showPalette}}):t._e(),t.isUser&&t.history.length?r("div",{staticClass:"history-btn",on:{click:t.toggleHistory}},[t._v(t._s(t.showHistory?"Hide":"Show")+" History")]):t._e(),t.isUser&&t.showHistory&&t.history.length?r("div",{staticClass:"history scroller"},t._l(t.history,(function(e,n){return r("div",{key:n,staticClass:"history-item"},["track"===e.type?r("Track",{attrs:{trackId:e.id,hideCover:!0,note:t.formatTimeDiff(t.nowDate-e.start-e.duration)}}):t._e(),"skipped"===e.type?r("div",{staticClass:"skipped-container",class:{open:t.openSkips[n]}},[r("span",{on:{click:function(e){return t.toggleSkip(n)}}},[t._v(t._s(e.tracks.length)+" Song"+t._s(1===e.tracks.length?"":"s")+" Skipped")]),r("div",{directives:[{name:"show",rawName:"v-show",value:t.openSkips[n],expression:"openSkips[i]"}],staticClass:"skipped"},t._l(e.tracks,(function(t,e){return r("Track",{key:e,attrs:{trackId:t,hideCover:!0}})})),1)]):t._e()],1)})),0):t._e()],1)},Rt=[],Ct=r("d146"),It=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"spotify-track",class:{small:!t.large}},[t.hideCover?t._e():r("div",{staticClass:"cover-wrapper"},[r("div",{staticClass:"cover-fade",style:{background:"linear-gradient(to right, "+t.bg+", rgba(0, 0, 0, 0))"}}),r("img",{staticClass:"cover",attrs:{src:t.coverImage,alt:t.albumName,title:t.albumName}})]),r("div",{staticClass:"content",style:{background:t.bg,color:t.text}},[r("div",{staticClass:"title"},[r("a",{attrs:{href:"https://open.spotify.com/track/"+t.trackId,target:"_blank"}},[t._v(t._s(t.tracks[t.trackId].name))]),r("div",{staticClass:"spacer"}),t.note?r("span",{staticClass:"note"},[t._v(t._s(t.note))]):t._e()]),r("div",{staticClass:"artists"},t._l(t.tracks[t.trackId].artists,(function(e,n){return r("span",{key:e},[r("a",{attrs:{href:"https://open.spotify.com/artist/"+e,target:"_blank"}},[t._v(t._s(t.artists[e].name))]),n!==t.tracks[t.trackId].artists.length-1?r("span",[t._v(", ")]):t._e()])})),0)]),t.showPalette?r("div",{staticClass:"palette"},t._l(t.palette,(function(t,e){return r("div",{key:e,staticClass:"swatch",style:{background:t}})})),0):t._e()])},Et=[],Ut=r("0621"),At=r.n(Ut);function Ht(t){return Ht="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ht(t)}function Mt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Bt(t,e,r){return e&&Lt(t.prototype,e),r&&Lt(t,r),t}function $t(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Nt(t,e)}function Nt(t,e){return Nt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Nt(t,e)}function qt(t){var e=zt();return function(){var r,n=Qt(t);if(e){var o=Qt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Vt(this,r)}}function Vt(t,e){return!e||"object"!==Ht(e)&&"function"!==typeof e?Jt(t):e}function Jt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function zt(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Qt(t){return Qt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Qt(t)}var Gt=1.8,Wt=function(t){$t(r,t);var e=qt(r);function r(){var t;return Mt(this,r),t=e.apply(this,arguments),t.bg="",t.text="",t.palette=[],t}return Bt(r,[{key:"onTrackUpdate",value:function(){this.autoPalette&&this.updatePalette()}},{key:"updatePalette",value:function(){var t=this;this.palette=[],this.bg="",this.text="",this.coverImage&&At.a.from(this.coverImage).getPalette().then((function(e){if(e.Vibrant&&e.Muted&&e.DarkVibrant&&e.DarkMuted&&e.LightVibrant&&e.LightMuted){t.bg=e.DarkMuted.getHex(),t.text=e.LightVibrant.getHex();var r=At.a.Util.rgbToHsl(e.LightVibrant.r,e.LightVibrant.g,e.LightVibrant.b),n=At.a.Util.rgbToHsl(e.DarkMuted.r,e.DarkMuted.g,e.DarkMuted.b),o=n[2],a=r[2],i=(Math.max(o,a)+.05)/(Math.min(o,a)+.05);if(i<Gt){var s=a;o<.5&&(s=Gt*(o+.05)-.05,s=Math.min(1,s));var c=r.slice(0,2).concat(s),u=At.a.Util.hslToRgb(c[0],c[1],c[2]),l=At.a.Util.rgbToHex(u[0],u[1],u[2]);t.text=l}t.showPalette&&(t.palette.push(e.Vibrant.getHex()),t.palette.push(e.Muted.getHex()),t.palette.push(e.DarkVibrant.getHex()),t.palette.push(e.DarkMuted.getHex()),t.palette.push(e.LightVibrant.getHex()),t.palette.push(e.LightMuted.getHex()))}}))}},{key:"created",value:function(){this.autoPalette&&this.updatePalette()}},{key:"coverImage",get:function(){var t=this.trackId,e=this.tracks,r=this.albums,n=e[t];if(!n)return console.log("Track %s not saved, from user %s",t,this.$parent.userId),null;var o=n.album,a=r[o];return a?a.images[0].url:(console.log("Album %s not saved, from track %s",o,t),null)}},{key:"albumName",get:function(){var t=this.trackId,e=this.tracks,r=this.albums,n=e[t];if(!n)return console.log("Track %s not saved, from user %s",t,this.$parent.userId),null;var o=n.album,a=r[o];return null==a?(console.log("Album %s not saved, from track %s",o,t),null):a.name}}]),r}(c["c"]);Object(s["a"])([Object(c["b"])({type:String,required:!0})],Wt.prototype,"trackId",void 0),Object(s["a"])([Object(c["b"])(Boolean)],Wt.prototype,"large",void 0),Object(s["a"])([Object(c["b"])(Boolean)],Wt.prototype,"autoPalette",void 0),Object(s["a"])([Object(c["b"])(Boolean)],Wt.prototype,"hideCover",void 0),Object(s["a"])([Object(c["b"])(Boolean)],Wt.prototype,"showPalette",void 0),Object(s["a"])([Object(c["b"])(String)],Wt.prototype,"note",void 0),Object(s["a"])([Object(c["d"])("trackId")],Wt.prototype,"onTrackUpdate",null),Wt=Object(s["a"])([Object(c["a"])({name:"Track",computed:Object(Pt["b"])(["tracks","albums","artists"])})],Wt);var Ft=Wt,Kt=Ft,Xt=(r("1af3"),Object(gt["a"])(Kt,It,Et,!1,null,null,null)),Yt=Xt.exports;function Zt(t){return Zt="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zt(t)}function te(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function re(t,e,r){return e&&ee(t.prototype,e),r&&ee(t,r),t}function ne(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&oe(t,e)}function oe(t,e){return oe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},oe(t,e)}function ae(t){var e=ce();return function(){var r,n=ue(t);if(e){var o=ue(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ie(this,r)}}function ie(t,e){return!e||"object"!==Zt(e)&&"function"!==typeof e?se(t):e}function se(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ce(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function ue(t){return ue=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},ue(t)}var le=Dt.a.parse(window.location.search.slice(1)),fe=null!=le.showpalette,pe=["https://canary.discordapp.com/assets/6debd47ed13483642cf09e832ed0bc1b.png"],ye=function(t){ne(r,t);var e=ae(r);function r(){var t;return te(this,r),t=e.apply(this,arguments),t.showHistory=!1,t.openSkips={},t.avatarError=!1,t.showPalette=fe,t}return re(r,[{key:"formatTimeDiff",value:function(t){return t<5e3?"just now":Object(Ct["a"])(this.nowDate,this.nowDate-t).replace(/(\d+) (second|minute|hour|day|week|month|year)s?/,(function(t,e,r){var n={second:"s",minute:"m",hour:"h",day:"d",week:"w",month:"mo",year:"y"}[r];return"".concat(e).concat(n," ago")}))}},{key:"toggleHistory",value:function(){this.showHistory=!this.showHistory}},{key:"toggleSkip",value:function(){}},{key:"onAvatarError",value:function(){this.avatarError=!0}},{key:"user",get:function(){var t=this.users[this.userId];return t?t.user:null}},{key:"scrobbles",get:function(){var t=this.users[this.userId];return t?t.scrobbles:[]}},{key:"lastScrobble",get:function(){var t=this.users[this.userId];return t&&t.scrobbles[0]||null}},{key:"lastScrobbleTime",get:function(){return this.lastScrobble?this.lastScrobble.endTime||this.nowDate:null}},{key:"now",get:function(){var t=this.lastScrobble;return t&&null==t.endTime?t.id:null}},{key:"avatarUrl",get:function(){if(!this.user)return pe[0];var t=this.avatarError,e=this.user.avatar;if(e&&!t){var r=e.startsWith("a_")?"gif":"png";return"https://cdn.discordapp.com/avatars/".concat(this.userId,"/").concat(e,".").concat(r,"?size=64")}return pe[0]}},{key:"status",get:function(){return this.now?"Listening":"Not Listening"}},{key:"statusColor",get:function(){return this.now?"#1ED760":"rgba(255, 255, 255, .5)"}},{key:"history",get:function(){for(var t=[],e=0;e<this.scrobbles.length-(this.scrobbles[0]?1:0);e+=1){var r=t[t.length-1],n=this.scrobbles[e],o=(n.endTime||this.nowDate)-n.startTime;o>2e4?t.push({type:"track",id:n.id,start:n.startTime,duration:o}):(r&&"skipped"===r.type||(t.push({type:"skipped",tracks:[]}),r=t[t.length-1]),"skipped"===r.type&&r.tracks.push(n.id))}var a=t[t.length-1];return a&&"track"!==a.type&&t.pop(),t}},{key:"isUser",get:function(){return this.user&&"0000"!==this.user.discriminator}}]),r}(c["c"]);Object(s["a"])([Object(c["b"])(String)],ye.prototype,"userId",void 0),ye=Object(s["a"])([Object(c["a"])({name:"User",components:{Track:Yt},computed:Object(Pt["b"])(["nowDate","tracks","albums","artists","users"])})],ye);var be=ye,de=be,he=(r("3056"),Object(gt["a"])(de,xt,Rt,!1,null,null,null)),ve=he.exports;function me(t){return me="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},me(t)}function ge(t){return Oe(t)||we(t)||Se(t)||ke()}function ke(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function we(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function Oe(t){if(Array.isArray(t))return Pe(t)}function _e(t,e){return De(t)||Te(t,e)||Se(t,e)||je()}function je(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Se(t,e){if(t){if("string"===typeof t)return Pe(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Pe(t,e):void 0}}function Pe(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Te(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done);n=!0)if(r.push(i.value),e&&r.length===e)break}catch(c){o=!0,a=c}finally{try{n||null==s["return"]||s["return"]()}finally{if(o)throw a}}return r}}function De(t){if(Array.isArray(t))return t}function xe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Re(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ce(t,e,r){return e&&Re(t.prototype,e),r&&Re(t,r),t}function Ie(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ee(t,e)}function Ee(t,e){return Ee=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ee(t,e)}function Ue(t){var e=Me();return function(){var r,n=Le(t);if(e){var o=Le(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ae(this,r)}}function Ae(t,e){return!e||"object"!==me(e)&&"function"!==typeof e?He(t):e}function He(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Me(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Le(t){return Le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Le(t)}var Be=Dt.a.parse(window.location.search.slice(1)),$e="string"===typeof Be.users?Be.users.split(","):["*"],Ne=Boolean(null!=Be.hidehistory),qe=[],Ve={},Je=function(t){Ie(r,t);var e=Ue(r);function r(){var t;return xe(this,r),t=e.apply(this,arguments),t.userIds=[],t.ready=!1,t.tracksQueue=Object(St["a"])(t.tracksHandler,2),t.loadingData={total:1,complete:0,desc:""},t}return Ce(r,[{key:"refreshData",value:function(){var t,e=this;return this.ready||(this.loadingData.total=1,this.loadingData.complete=0,this.loadingData.desc="Grabbing User Data"),nt.getUsers($e).then((function(r){t=r.map((function(t){return t.user.id}));var n=[],o=[];if(t.forEach((function(t){var o=r.find((function(e){return e.user.id===t}));o&&(Ne&&(o.scrobbles=[o.scrobbles[0]]),Ve[t]=o,o.scrobbles.forEach((function(r){/^[a-z0-9]{22}$/i.test(r.id)?n.includes(r.id)||e.tracks[r.id]||n.push(r.id):console.log('Invalid ID "%s" from user %s',r.id,t)})))})),n.length){for(var a=0;a<n.length;a+=1)a%50===0&&o.unshift([]),o[0].push(n[a]);return e.ready||(e.loadingData.total=o.length,e.loadingData.complete=0,e.loadingData.desc="Loading Spotify Data"),e.tracksQueue.push(o),e.tracksQueue.drain()}return null})).then((function(){e.$store.dispatch("saveTracks",qe),Object.entries(Ve).forEach((function(t){var r=_e(t,2),n=r[0],o=r[1];e.$store.dispatch("updateUser",{userId:n,data:o})})),e.userIds=t,e.$store.dispatch("reinitUsers"),qe=[],Ve={}})).catch((function(t){console.error(t)}))}},{key:"tracksHandler",value:function(t,e){var r=this,n=t;if(n.length>50){var o=n.slice(50);n=n.slice(0,50),this.tracksQueue.push([o])}ot.getTracks(n).then((function(t){var n,o=t.tracks;r.ready||(r.loadingData.complete+=1,console.log("Loaded %s tracks, %s buckets complete",o.length,r.loadingData.complete)),(n=qe).push.apply(n,ge(o)),e()})).catch((function(t){if(429===t.status){var o=parseInt(t.response.headers["retry-after"],10);console.log("Bucket ratelimited, retrying in %ss",o),setTimeout((function(){r.tracksHandler(n,e)}),1e3*o+500)}else 401===t.status?(console.log("Spotify access token expired, obtaining a fresh one"),nt.getSpotifyToken().then((function(t){var o=t.token,a=t.tokenType;ot.setToken(o,a),r.tracksHandler(n,e)}))):console.error(t)}))}},{key:"dataInterval",value:function(){var t=this;setTimeout((function(){t.refreshData().then((function(){t.dataInterval()}))}),1e3)}},{key:"sortUsers",value:function(){var t=this.users,e=[],r=[];this.userIds.forEach((function(n){var o=t[n];o&&(o.scrobbles[0]&&null==o.scrobbles[0].endTime?e.push(n):r.push(n))})),e.sort((function(e,r){var n=t[e],o=t[r];return n&&o?n.user.username.toLowerCase()>o.user.username.toLowerCase()?1:n.user.username.toLowerCase()<o.user.username.toLowerCase()?-1:0:0})),r.sort((function(e,r){var n=t[e],o=t[r];return n&&o?n.scrobbles[0].startTime>o.scrobbles[0].startTime?-1:n.scrobbles[0].startTime<o.scrobbles[0].startTime?1:0:0})),this.userIds=e.concat(r)}},{key:"created",value:function(){var t=this;this.$store.dispatch("loadIndexedDB").then((function(){return t.refreshData()})).then((function(){t.ready=!0,t.dataInterval()})),this.$store.subscribe((function(e){"reinitUsers"===e.type&&t.sortUsers()}))}}]),r}(c["c"]);Je=Object(s["a"])([Object(c["a"])({name:"Home",components:{User:ve},computed:Object(Pt["b"])(["tracks","users"])})],Je);var ze=Je,Qe=ze,Ge=(r("21bb"),Object(gt["a"])(Qe,_t,jt,!1,null,null,null)),We=Ge.exports;n["a"].use(Ot["a"]);var Fe=new Ot["a"]({mode:"hash",routes:[{path:"/",component:We}]}),Ke=r("a002"),Xe=r.n(Ke);function Ye(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,o)}function Ze(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){Ye(a,n,o,i,s,"next",t)}function s(t){Ye(a,n,o,i,s,"throw",t)}i(void 0)}))}}function tr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function er(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?tr(Object(r),!0).forEach((function(e){rr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):tr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function rr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}n["a"].use(Pt["a"]);var nr=new Pt["a"].Store({state:{nowDate:Date.now(),tracks:{},albums:{},artists:{},users:{},localforageEnabled:!0},mutations:{saveTrack:function(t,e){var r=e.id,n=e.track;t.tracks[r]=n},saveAlbum:function(t,e){var r=e.id,n=e.album;t.albums[r]=n},saveArtist:function(t,e){var r=e.id,n=e.artist;t.artists[r]=n},setNowDate:function(t,e){t.nowDate=e},updateUser:function(t,e){var r=e.userId,n=e.data;t.users[r]=er(er({},t.users[r]),n)},reinitUsers:function(t){t.users=er({},t.users)},disableLocalforage:function(t){t.localforageEnabled=!1}},actions:{updateNow:function(t){var e=t.commit;e("setNowDate",Date.now())},loadIndexedDB:function(){return Ze(p.a.mark((function t(){return p.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},saveTracks:function(t,e){return Ze(p.a.mark((function r(){var n,o,a;return p.a.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=t.commit,o=t.state,a=0,e.forEach((function(t){t.id in o.tracks||(a+=1,n("saveTrack",{id:t.id,track:{id:t.id,album:t.album.id,artists:t.artists.map((function(t){return t.id})),name:t.name,duration:t.duration_ms}}),t.artists.forEach((function(t){t.id in o.artists||n("saveArtist",{id:t.id,artist:{id:t.id,name:t.name}})})),t.album.id in o.albums||n("saveAlbum",{id:t.album.id,album:{id:t.album.id,name:t.album.name,images:t.album.images}}))})),!(a>0&&o.localforageEnabled)){r.next=10;break}return r.next=6,Xe.a.setItem("tracks",JSON.stringify(o.tracks));case 6:return r.next=8,Xe.a.setItem("artists",JSON.stringify(o.artists));case 8:return r.next=10,Xe.a.setItem("albums",JSON.stringify(o.albums));case 10:case"end":return r.stop()}}),r)})))()},updateUser:function(t,e){var r=t.commit,n=e.userId,o=e.data;r("updateUser",{userId:n,data:o})},reinitUsers:function(t){var e=t.commit;e("reinitUsers")}}});n["a"].use(o["a"]),n["a"].config.productionTip=!1,new n["a"]({router:Fe,store:nr,render:function(t){return t(wt)}}).$mount("#app")}});
//# sourceMappingURL=app.5eda9cc2.js.map